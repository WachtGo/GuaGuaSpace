"use strict";(self["webpackChunkmyblog"]=self["webpackChunkmyblog"]||[]).push([[275],{9275:function(e,s,t){t.r(s),t.d(s,{default:function(){return c}});var a=function(){var e=this,s=e._self._c;return s("div",{staticClass:"message"},[s("div",{staticClass:"message_board"},[s("div",{staticClass:"go_box"},[s("div",{staticClass:"go_top",on:{click:function(s){return e.goTopBottom(!0)}}},[s("img",{staticClass:"iconImage",attrs:{src:t(7609),alt:" "}})]),s("div",{staticClass:"go_bottom",on:{click:function(s){return e.goTopBottom(!1)}}},[s("img",{staticClass:"iconImage",attrs:{src:t(1117),alt:" "}})])]),s("div",{staticClass:"board_top"},[e._v(" 我的留言板 "),s("div",{staticClass:"board_sort",on:{click:function(s){e.positiveOrder=!e.positiveOrder}}},[s("img",{staticClass:"board_sort_icon",attrs:{src:t(6758),alt:" "}})])]),s("div",{directives:[{name:"show",rawName:"v-show",value:e.noReadCount>=1,expression:"noReadCount >= 1"}],staticClass:"board_new_message"},[s("i",[e._v(e._s(e.noReadCount))])]),s("div",{staticClass:"message_ulouter",attrs:{id:"message_ulouter_id"},on:{scroll:e.watchScroll}},[s("ul",{staticClass:"message_ul",attrs:{id:"message_ul_id"}},e._l(e.messageBoardComputed,(function(a,i){return s("li",{key:i},[a._id?s("div",{staticClass:"message_content"},[s("div",{staticClass:"message_line"},[s("pre",[e._v(e._s(a.content))])]),s("div",{staticClass:"message_info"},[s("div",{staticClass:"message_writer"},[s("b",[s("i",[e._v("来自："+e._s(a.writer))])])]),s("div",{staticClass:"message_time"},[s("b",[s("i",[e._v(e._s(a.createTime))])])])]),!e.token||e.messageOwnerId!==e.userInfo._id&&"wacht"!==e.userInfo.username?e._e():s("div",{staticClass:"message_delete"},[s("img",{staticClass:"delete_image",attrs:{src:t(6820),alt:" "},on:{click:function(s){return e.deleteMessage(a._id)}}})])]):e._e()])})),0)])]),s("div",{staticClass:"message_box"},[s("div",{staticClass:"message_box_title"},[e._v("我想说:")]),s("div",{staticClass:"write_box"},[s("textarea",{directives:[{name:"model",rawName:"v-model.trim",value:e.messageBox.content,expression:"messageBox.content",modifiers:{trim:!0}}],staticClass:"wtite_box_input",attrs:{name:"",id:"",cols:"30",rows:"10"},domProps:{value:e.messageBox.content},on:{input:function(s){s.target.composing||e.$set(e.messageBox,"content",s.target.value.trim())},blur:function(s){return e.$forceUpdate()}}})]),s("div",{staticClass:"write_info"},[s("div",{staticClass:"write_name"},[s("span",[e._v("昵称：")]),s("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.messageBox.writer,expression:"messageBox.writer",modifiers:{trim:!0}}],staticClass:"write_input",attrs:{type:"text",placeholder:"随便写"},domProps:{value:e.messageBox.writer},on:{input:function(s){s.target.composing||e.$set(e.messageBox,"writer",s.target.value.trim())},blur:function(s){return e.$forceUpdate()}}})]),s("button",{staticClass:"my_button",on:{click:e.writeMessage}},[e._v("发送")])])])])},i=[],r=t(2930),o=t(7214),n={data(){return{boardUserShow:!1,messageOwnername:"",messageOwnerId:"",messageOwnerAvatar:"",boardUsers:[],messageBoard:[{content:"",writer:"",createTime:"",_id:null}],messageBox:{content:"",writer:"",createTime:0},positiveOrder:!0,warntimer:null,noReadCount:0,baseHeight:0,diva:null,message_ulouter:null,messageLength:0}},created(){this.messageOwnerAvatar=this.$store.state.userInfo.avatar,this.messageOwnerName=this.$store.state.userInfo.nickname,this.messageOwnerId=this.$store.state.userInfo._id,this.getMessages()},mounted(){this.diva=document.getElementById("message_ul_id"),this.message_ulouter=document.getElementById("message_ulouter_id"),setInterval((()=>{this.getMessages(this.getBoardLocation())}),1800)},computed:{userInfo(){return this.$store.state.userInfo},token(){return this.$store.state.token},messageBoardComputed(){return this.messageBoard}},watch:{positiveOrder:{handler(){this.messageBoard.reverse()}},messageBoard:{handler(){this.$store.commit("updateMessageCount",this.messageBoard.length)}}},methods:{getMessages(e){(0,r._U)({id:this.messageOwnerId}).then((async s=>{if(!s.data.data)return;const t=this.messageBoard.length!==s.data.data.length;this.messageBoard=await s.data.data,this.baseHeight=Number((this.diva.scrollHeight/this.messageBoard.length).toFixed(2)),this.watchScroll(),this.messageBoard.forEach((e=>{e.createTime=(0,o.p6)(e.createTime)})),e&&t&&this.$nextTick((()=>{this.goTopBottom(!1)})),this.positiveOrder||this.messageBoard.reverse()}))},writeMessage(){if(""===this.messageBox.content||""===this.messageBox.writer){if(this.warntimer)return;return this.$message.warning("留言内容和你的大名不能为空"),void(this.warntimer=setTimeout((()=>{this.warntimer=null}),3e3))}let e="";e=this.messageOwnerId?this.messageOwnerId:this.userInfo._id;let s={content:this.messageBox.content,writer:this.messageBox.writer,id:e,createTime:(new Date).getTime()};(0,r.Hv)(s).then((e=>{this.messageBox.content="",this.getMessages(!0)})).catch((e=>{}))},deleteMessage(e){(0,r.$Z)({_id:e}).then((e=>{e.data.status?this.$message.success(e.data.msg):this.$message.warn(e.data.msg),this.getMessages()})).catch((e=>{}))},watchScroll(){this.baseHeight<1||(this.noReadCount=Math.ceil((this.diva.scrollHeight-(this.message_ulouter.scrollTop+this.message_ulouter.clientHeight))/this.baseHeight)-1)},getBoardLocation(){return this.diva.scrollHeight-this.message_ulouter.scrollTop<=this.message_ulouter.clientHeight+this.baseHeight},goTopBottom(e){this.message_ulouter.scrollTop=e?0:this.message_ulouter.scrollHeight-this.message_ulouter.clientHeight}}},m=n,l=t(1001),g=(0,l.Z)(m,a,i,!1,null,"04c7b2b0",null),c=g.exports}}]);