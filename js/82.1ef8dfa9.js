"use strict";(self["webpackChunkmyblog"]=self["webpackChunkmyblog"]||[]).push([[82],{2082:function(e,s,t){t.r(s),t.d(s,{default:function(){return l}});var a=function(){var e=this,s=e._self._c;return s("div",{staticClass:"message"},[s("div",{staticClass:"message_board"},[s("div",{staticClass:"go_box"},[s("div",{staticClass:"go_top",on:{click:function(s){return e.goTopBottom(!0)}}},[s("img",{staticClass:"iconImage",attrs:{src:t(7609),alt:" "}})]),s("div",{staticClass:"go_bottom",on:{click:function(s){return e.goTopBottom(!1)}}},[s("img",{staticClass:"iconImage",attrs:{src:t(1117),alt:" "}})])]),s("div",{staticClass:"board_top"},[e._v(" 大家的留言板 "),s("div",{staticClass:"board_owner",on:{click:function(s){e.boardUserShow=!e.boardUserShow}}},[e.messageOwnerAvatar?s("img",{attrs:{src:e.messageOwnerAvatar,alt:" "}}):s("img",{attrs:{src:e.userInfo.avatar,alt:" "}})]),s("span",{staticClass:"board_top_tips",on:{click:function(s){e.boardUserShow=!e.boardUserShow}}},[s("img",{attrs:{src:t(1339),alt:" "}})]),s("div",{directives:[{name:"show",rawName:"v-show",value:e.boardUserShow,expression:"boardUserShow"}],staticClass:"board_select_wrap"},[s("ul",{staticClass:"board_select_ul"},e._l(e.boardUsers,(function(t){return s("li",{key:t._id,staticClass:"board_select_li",on:{click:function(s){return e.selectBoard(t._id,t.avatar)}}},[s("div",{staticClass:"board_select_avatar"},[s("img",{attrs:{src:t.avatar,alt:" "}})]),s("div",{staticClass:"board_select_name"},[e._v(e._s(t.nickname))])])})),0)]),s("div",{staticClass:"board_sort",on:{click:function(s){e.positiveOrder=!e.positiveOrder}}},[s("img",{staticClass:"board_sort_icon",attrs:{src:t(6758),alt:" "}})])]),s("div",{directives:[{name:"show",rawName:"v-show",value:e.noReadCount>=1,expression:"noReadCount >= 1"}],staticClass:"board_new_message"},[s("i",[e._v(e._s(e.noReadCount))])]),s("div",{staticClass:"message_ulouter",attrs:{id:"message_ulouter_id"},on:{scroll:e.watchScroll}},[s("ul",{staticClass:"message_ul",attrs:{id:"message_ul_id"}},e._l(e.messageBoardComputed,(function(a,i){return s("li",{key:i},[a._id?s("div",{staticClass:"message_content"},[s("div",{staticClass:"message_line"},[s("pre",[e._v(e._s(a.content))])]),s("div",{staticClass:"message_info"},[s("div",{staticClass:"message_writer"},[s("b",[s("i",[e._v("来自："+e._s(a.writer))])])]),s("div",{staticClass:"message_time"},[s("b",[s("i",[e._v(e._s(a.createTime))])])])]),!e.token||e.messageOwnerId!==e.userInfo._id&&"wacht"!==e.userInfo.username?e._e():s("div",{staticClass:"message_delete"},[s("img",{staticClass:"delete_image",attrs:{src:t(6820),alt:" "},on:{click:function(s){return e.deleteMessage(a._id)}}})])]):e._e()])})),0)])]),s("div",{staticClass:"message_box"},[s("div",{staticClass:"message_box_title"},[e._v("我想说:")]),s("div",{staticClass:"write_box"},[s("textarea",{directives:[{name:"model",rawName:"v-model.trim",value:e.messageBox.content,expression:"messageBox.content",modifiers:{trim:!0}}],staticClass:"wtite_box_input",attrs:{name:"",id:"",cols:"30",rows:"10"},domProps:{value:e.messageBox.content},on:{input:function(s){s.target.composing||e.$set(e.messageBox,"content",s.target.value.trim())},blur:function(s){return e.$forceUpdate()}}})]),s("div",{staticClass:"write_info"},[s("div",{staticClass:"write_name"},[s("span",[e._v("昵称：")]),s("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.messageBox.writer,expression:"messageBox.writer",modifiers:{trim:!0}}],staticClass:"write_input",attrs:{type:"text",placeholder:"随便写"},domProps:{value:e.messageBox.writer},on:{input:function(s){s.target.composing||e.$set(e.messageBox,"writer",s.target.value.trim())},blur:function(s){return e.$forceUpdate()}}})]),s("button",{staticClass:"my_button",on:{click:e.writeMessage}},[e._v("发送")])])])])},i=[],r=t(2930),o=t(7214),g={data(){return{boardUserShow:!1,messageOwnername:"",messageOwnerId:"",messageOwnerAvatar:"",boardUsers:[],messageBoard:[{content:"",writer:"",createTime:"",_id:null}],messageBox:{content:"",writer:"",createTime:0},positiveOrder:!0,warntimer:null,noReadCount:0,baseHeight:0,diva:null,message_ulouter:null,messageLength:0}},created(){this.messageOwnerAvatar=this.$store.state.userInfo.avatar,this.messageOwnerName=this.$store.state.userInfo.nickname,this.messageOwnerId=this.$store.state.userInfo._id,this.getMessages(),this.getBoardUsers()},mounted(){this.diva=document.getElementById("message_ul_id"),this.message_ulouter=document.getElementById("message_ulouter_id"),setInterval((()=>{this.getMessages(this.getBoardLocation())}),1800)},computed:{userInfo(){return this.$store.state.userInfo},token(){return this.$store.state.token},messageBoardComputed(){return this.messageBoard}},watch:{positiveOrder:{handler(){this.messageBoard.reverse()}},messageBoard:{handler(){this.$store.commit("updateMessageCount",this.messageBoard.length)}}},methods:{getMessages(e){(0,r._U)({id:this.messageOwnerId}).then((async s=>{if(!s.data.data)return;const t=this.messageBoard.length!==s.data.data.length;this.messageBoard=await s.data.data,this.baseHeight=Number((this.diva.scrollHeight/this.messageBoard.length).toFixed(2)),this.watchScroll(),this.messageBoard.forEach((e=>{e.createTime=(0,o.p6)(e.createTime)})),e&&t&&this.$nextTick((()=>{this.goTopBottom(!1)})),this.positiveOrder||this.messageBoard.reverse()}))},writeMessage(){if(""===this.messageBox.content||""===this.messageBox.writer){if(this.warntimer)return;return this.$message.warning("留言内容和你的大名不能为空"),void(this.warntimer=setTimeout((()=>{this.warntimer=null}),3e3))}let e="";e=this.messageOwnerId?this.messageOwnerId:this.userInfo._id;let s={content:this.messageBox.content,writer:this.messageBox.writer,id:e,createTime:(new Date).getTime()};(0,r.Hv)(s).then((e=>{this.messageBox.content="",this.getMessages(!0)})).catch((e=>{}))},deleteMessage(e){(0,r.$Z)({_id:e}).then((e=>{e.data.status?this.$message.success(e.data.msg):this.$message.warn(e.data.msg),this.getMessages()})).catch((e=>{}))},watchScroll(){this.baseHeight<1||(this.noReadCount=Math.ceil((this.diva.scrollHeight-(this.message_ulouter.scrollTop+this.message_ulouter.clientHeight))/this.baseHeight)-1)},getBoardLocation(){return this.diva.scrollHeight-this.message_ulouter.scrollTop<=this.message_ulouter.clientHeight+this.baseHeight},goTopBottom(e){this.message_ulouter.scrollTop=e?0:this.message_ulouter.scrollHeight-this.message_ulouter.clientHeight},getBoardUsers(){(0,r.X2)().then((e=>{this.boardUsers=e.data.data})).catch((e=>{}))},selectBoard(e,s){this.messageOwnerId=e,this.messageOwnerAvatar=s,this.noReadCount=0,this.getMessages()}}},n=g,c=t(1001),m=(0,c.Z)(n,a,i,!1,null,"0f7a53bf",null),l=m.exports},1339:function(e){e.exports="data:image/png;base64,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"}}]);